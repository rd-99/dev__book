{"ast":null,"code":"import _createForOfIteratorHelper from \"@babel/runtime/helpers/createForOfIteratorHelper\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"className\", \"source\", \"style\", \"onScroll\", \"onMouseOver\"];\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useImperativeHandle } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport gfm from 'remark-gfm';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-markup';\nimport { loadLang } from './langs';\nimport \"./styles/markdown.css\";\nimport \"./styles/markdowncolor.css\";\nexport default /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var _ref = props || {},\n    className = _ref.className,\n    source = _ref.source,\n    style = _ref.style,\n    onScroll = _ref.onScroll,\n    onMouseOver = _ref.onMouseOver,\n    other = _objectWithoutProperties(_ref, _excluded);\n  var mdp = /*#__PURE__*/React.createRef();\n  var loadedLang = React.useRef(['markup']);\n  useEffect(function () {\n    highlight(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n  function highlight() {\n    return _highlight.apply(this, arguments);\n  }\n  function _highlight() {\n    _highlight = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var codes, _iterator, _step, val, tag, lang;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (mdp.current) {\n                _context.next = 2;\n                break;\n              }\n              return _context.abrupt(\"return\");\n            case 2:\n              codes = mdp.current.getElementsByTagName('code');\n              _iterator = _createForOfIteratorHelper(codes);\n              _context.prev = 4;\n              _iterator.s();\n            case 6:\n              if ((_step = _iterator.n()).done) {\n                _context.next = 24;\n                break;\n              }\n              val = _step.value;\n              tag = val.parentNode;\n              if (!(tag && tag.tagName === 'PRE' && /^language-/.test(val.className.trim()))) {\n                _context.next = 22;\n                break;\n              }\n              lang = val.className.trim().replace(/^language-/, '');\n              _context.prev = 11;\n              if (loadedLang.current.includes(lang)) {\n                _context.next = 16;\n                break;\n              }\n              loadedLang.current.push(lang);\n              _context.next = 16;\n              return loadLang(lang);\n            case 16:\n              _context.next = 18;\n              return Prism.highlightElement(val);\n            case 18:\n              _context.next = 22;\n              break;\n            case 20:\n              _context.prev = 20;\n              _context.t0 = _context[\"catch\"](11);\n            case 22:\n              _context.next = 6;\n              break;\n            case 24:\n              _context.next = 29;\n              break;\n            case 26:\n              _context.prev = 26;\n              _context.t1 = _context[\"catch\"](4);\n              _iterator.e(_context.t1);\n            case 29:\n              _context.prev = 29;\n              _iterator.f();\n              return _context.finish(29);\n            case 32:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 26, 29, 32], [11, 20]]);\n    }));\n    return _highlight.apply(this, arguments);\n  }\n  useImperativeHandle(ref, function () {\n    return _objectSpread(_objectSpread({}, props), {}, {\n      lang: loadedLang.current,\n      mdp: mdp\n    });\n  }, [mdp, props]);\n  var cls = \"wmde-markdown wmde-markdown-color \".concat(className || '');\n  var reactMarkdownProps = _objectSpread(_objectSpread({\n    allowDangerousHtml: true,\n    allowNode: function allowNode(node, index, parent) {\n      if (node.type === 'html' && reactMarkdownProps.allowDangerousHtml) {\n        // filter style\n        node.value = node.value.replace(/<((style|script|link|input|form)|\\/(style|script|link|input|form))(\\s?[^>]*>)/gi, function (a) {\n          return a.replace(/[<>]/g, function (e) {\n            return {\n              '<': '&lt;',\n              '>': '&gt;'\n            }[e];\n          });\n        });\n      }\n      return true;\n    }\n  }, other), {}, {\n    plugins: [gfm].concat(_toConsumableArray(other.plugins || [])),\n    source: source || ''\n  });\n  return /*#__PURE__*/React.createElement(\"div\", {\n    ref: mdp,\n    onScroll: onScroll,\n    onMouseOver: onMouseOver,\n    className: cls,\n    style: style\n  }, /*#__PURE__*/React.createElement(ReactMarkdown, reactMarkdownProps));\n});","map":{"version":3,"names":["React","useEffect","useImperativeHandle","ReactMarkdown","gfm","Prism","loadLang","forwardRef","props","ref","_ref","className","source","style","onScroll","onMouseOver","other","_objectWithoutProperties","_excluded","mdp","createRef","loadedLang","useRef","highlight","_highlight","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","codes","_iterator","_step","val","tag","lang","wrap","_callee$","_context","prev","next","current","abrupt","getElementsByTagName","_createForOfIteratorHelper","s","n","done","value","parentNode","tagName","test","trim","replace","includes","push","highlightElement","t0","t1","e","f","finish","stop","_objectSpread","cls","concat","reactMarkdownProps","allowDangerousHtml","allowNode","node","index","parent","type","a","plugins","_toConsumableArray","createElement"],"sources":["../../src/index.tsx"],"sourcesContent":["import React, { useEffect, useImperativeHandle } from 'react';\nimport ReactMarkdown, { ReactMarkdownProps } from 'react-markdown';\nimport gfm from 'remark-gfm';\nimport Prism from 'prismjs';\nimport 'prismjs/components/prism-markup';\nimport { loadLang } from './langs';\nimport './styles/markdown.less';\nimport './styles/markdowncolor.less';\n\nexport type MarkdownPreviewProps = {\n  className?: string;\n  source?: string;\n  style?: React.CSSProperties;\n  onScroll?: (e: React.UIEvent<HTMLDivElement>) => void;\n  onMouseOver?: (e: React.MouseEvent<HTMLDivElement>) => void;\n} & ReactMarkdownProps;\n\nexport type MarkdownPreviewRef = {\n  mdp: React.RefObject<HTMLDivElement>;\n  lang: string[],\n} & MarkdownPreviewProps;\n\nexport default React.forwardRef<MarkdownPreviewRef, MarkdownPreviewProps>((props, ref) => {\n  const { className, source, style, onScroll, onMouseOver, ...other  } = props || {};\n  const mdp = React.createRef<HTMLDivElement>();\n  const loadedLang = React.useRef<string[]>(['markup']);\n  useEffect(() => {\n    highlight();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n\n  async function highlight() {\n    if (!mdp.current) return;\n    const codes = mdp.current.getElementsByTagName('code') as unknown as HTMLElement[];\n    for (const val of codes) {\n      const tag = val.parentNode as HTMLElement;\n      if (tag && tag.tagName === 'PRE' && /^language-/.test(val.className.trim())) {\n        const lang = val.className.trim().replace(/^language-/, '');\n        try {\n          if (!loadedLang.current.includes(lang as never)) {\n            loadedLang.current.push(lang);\n            await loadLang(lang);\n          }\n          await Prism.highlightElement(val);\n        } catch (error) { }\n      }\n    }\n  }\n\n  useImperativeHandle(ref, () => ({ ...props, lang: loadedLang.current, mdp }), [mdp, props]);\n\n  const cls = `wmde-markdown wmde-markdown-color ${className || ''}`;\n  const reactMarkdownProps = {\n    allowDangerousHtml: true,\n    allowNode: (node, index, parent) => {\n      if (node.type === 'html' && reactMarkdownProps.allowDangerousHtml) {\n        // filter style\n        node.value = (node.value as string).replace(/<((style|script|link|input|form)|\\/(style|script|link|input|form))(\\s?[^>]*>)/gi, (a: string) => {\n          return a.replace(/[<>]/g, (e: string) => (({ '<': '&lt;', '>': '&gt;' } as { [key: string]: string })[e]))\n        });\n      }\n      return true;\n    },\n    ...other,\n    plugins: [gfm,  ...(other.plugins || [])],\n    source: source || '',\n  } as ReactMarkdownProps;\n  return (\n    <div ref={mdp} onScroll={onScroll} onMouseOver={onMouseOver} className={cls} style={style}>\n      <ReactMarkdown {...reactMarkdownProps} />\n    </div>\n  );\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}