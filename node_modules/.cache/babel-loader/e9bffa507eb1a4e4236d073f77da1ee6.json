{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Acer/Desktop/dev__book/dev__book/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Acer/Desktop/dev__book/dev__book/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import axios from'axios';import localForage from'localforage';//import { OutputFileType } from 'typescript';\nvar fileCache=localForage.createInstance({name:'filecache'});export var fetchPlugin=function fetchPlugin(inputCode){return{name:'fetch-plugin',setup:function setup(build){build.onLoad({filter:/(^index\\.js$)/},function(){return{loader:'jsx',contents:inputCode};});build.onLoad({filter:/.*/},/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(args){var cachedResult;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fileCache.getItem(args.path);case 2:cachedResult=_context.sent;if(!cachedResult){_context.next=5;break;}return _context.abrupt(\"return\",cachedResult);case 5:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}());build.onLoad({filter:/.css$/},/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(args){var _yield$axios$get,data,request,escaped,contents,result;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get(args.path);case 2:_yield$axios$get=_context2.sent;data=_yield$axios$get.data;request=_yield$axios$get.request;escaped=data.replace(/\\n/g,'').replace(/\"/g,'\\\\\"').replace(/'/g,\"\\\\'\");contents=\"\\n        const style = document.createElement('style');\\n        style.innerText = '\".concat(escaped,\"';\\n        document.head.appendChild(style);\\n        \");// const loader = args.path.match(/.css$/) ? 'css' : 'jsx';\nresult={loader:'jsx',contents:contents,resolveDir:new URL('./',request.responseURL).pathname};_context2.next=10;return fileCache.setItem(args.path,result);case 10:return _context2.abrupt(\"return\",result);case 11:case\"end\":return _context2.stop();}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}());build.onLoad({filter:/.*/},/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(args){var _yield$axios$get2,data,request,result;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return axios.get(args.path);case 2:_yield$axios$get2=_context3.sent;data=_yield$axios$get2.data;request=_yield$axios$get2.request;// const loader = args.path.match(/.css$/) ? 'css' : 'jsx';\nresult={loader:'jsx',contents:data,resolveDir:new URL('./',request.responseURL).pathname};_context3.next=8;return fileCache.setItem(args.path,result);case 8:return _context3.abrupt(\"return\",result);case 9:case\"end\":return _context3.stop();}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}());}};};","map":{"version":3,"names":["axios","localForage","fileCache","createInstance","name","fetchPlugin","inputCode","setup","build","onLoad","filter","loader","contents","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","args","cachedResult","wrap","_callee$","_context","prev","next","getItem","path","sent","abrupt","stop","_x","apply","arguments","_ref2","_callee2","_yield$axios$get","data","request","escaped","result","_callee2$","_context2","get","replace","concat","resolveDir","URL","responseURL","pathname","setItem","_x2","_ref3","_callee3","_yield$axios$get2","_callee3$","_context3","_x3"],"sources":["C:/Users/Acer/Desktop/dev__book/dev__book/src/bundler/plugins/fetch-plugin.ts"],"sourcesContent":["import * as esbuild from 'esbuild-wasm';\r\nimport axios from 'axios';\r\nimport localForage from 'localforage';\r\n//import { OutputFileType } from 'typescript';\r\n\r\nconst fileCache = localForage.createInstance({\r\n  name: 'filecache',\r\n});\r\n\r\nexport const fetchPlugin = (inputCode: string) => {\r\n  return {\r\n    name: 'fetch-plugin',\r\n    setup(build: esbuild.PluginBuild) {\r\n      build.onLoad({filter: /(^index\\.js$)/ }, () => {\r\n        return {\r\n          loader: 'jsx',\r\n          contents: inputCode,\r\n        };\r\n      });\r\n        build.onLoad({ filter: /.*/ }, async (args: any) => {\r\n        const cachedResult = await fileCache.getItem<esbuild.OnLoadResult>(\r\n          args.path\r\n        );\r\n\r\n        if (cachedResult) {\r\n          return cachedResult;\r\n        }\r\n      });\r\n\r\n      build.onLoad({ filter: /.css$/ } ,async (args: any) => {\r\n        \r\n        const { data, request } = await axios.get(args.path);        \r\n        const escaped = data\r\n        .replace(/\\n/g, '')\r\n        .replace(/\"/g,  '\\\\\"')\r\n        .replace(/'/g,\"\\\\'\");\r\n        const contents = \r\n        `\r\n        const style = document.createElement('style');\r\n        style.innerText = '${escaped}';\r\n        document.head.appendChild(style);\r\n        `;\r\n        \r\n\r\n\r\n       // const loader = args.path.match(/.css$/) ? 'css' : 'jsx';\r\n        const result: esbuild.OnLoadResult = {\r\n          loader : 'jsx',\r\n          contents,\r\n          resolveDir: new URL('./', request.responseURL).pathname,\r\n        };\r\n        await fileCache.setItem(args.path, result);\r\n\r\n        return result;\r\n        \r\n      })\r\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\r\n        \r\n        const { data, request } = await axios.get(args.path);        \r\n        \r\n        \r\n\r\n\r\n       // const loader = args.path.match(/.css$/) ? 'css' : 'jsx';\r\n        const result: esbuild.OnLoadResult = {\r\n          loader : 'jsx',\r\n          contents : data,\r\n          resolveDir: new URL('./', request.responseURL).pathname,\r\n        };\r\n        await fileCache.setItem(args.path, result);\r\n\r\n        return result;\r\n      });\r\n    },\r\n  };\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}